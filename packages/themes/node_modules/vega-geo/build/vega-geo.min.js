!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vega-dataflow"),require("vega-util"),require("vega-statistics"),require("vega-projection"),require("vega-canvas")):"function"==typeof define&&define.amd?define(["exports","vega-dataflow","vega-util","vega-statistics","vega-projection","vega-canvas"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).vega=e.vega||{},e.vega.transforms={}),e.vega,e.vega,e.vega,e.vega,e.vega)}(this,(function(e,t,n,r,i,a){"use strict";const o=Math.sqrt(50),s=Math.sqrt(10),u=Math.sqrt(2);function l(e,t,n){const r=(t-e)/Math.max(0,n),i=Math.floor(Math.log10(r)),a=r/Math.pow(10,i),c=a>=o?10:a>=s?5:a>=u?2:1;let h,f,d;return i<0?(d=Math.pow(10,-i)/c,h=Math.round(e*d),f=Math.round(t*d),h/d<e&&++h,f/d>t&&--f,d=-d):(d=Math.pow(10,i)*c,h=Math.round(e/d),f=Math.round(t/d),h*d<e&&++h,f*d>t&&--f),f<h&&.5<=n&&n<2?l(e,t,2*n):[h,f,d]}function c(e,t,n){return l(e=+e,t=+t,n=+n)[2]}function h(e,t){let n;for(const t of e)null!=t&&(n<t||void 0===n&&t>=t)&&(n=t);return n}function f(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((t-e)/n)),a=new Array(i);++r<i;)a[r]=e+r*n;return a}function d(){}const p=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function m(){var e=1,t=1,r=s;function i(e,t){return t.map((t=>a(e,t)))}function a(n,i){var a=[],s=[];return function(n,r,i){var a,s,u,l,c,h,f=[],d=[];a=s=-1,l=n[0]>=r,p[l<<1].forEach(m);for(;++a<e-1;)u=l,l=n[a+1]>=r,p[u|l<<1].forEach(m);p[l<<0].forEach(m);for(;++s<t-1;){for(a=-1,l=n[s*e+e]>=r,c=n[s*e]>=r,p[l<<1|c<<2].forEach(m);++a<e-1;)u=l,l=n[s*e+e+a+1]>=r,h=c,c=n[s*e+a+1]>=r,p[u|l<<1|c<<2|h<<3].forEach(m);p[l|c<<3].forEach(m)}a=-1,c=n[s*e]>=r,p[c<<2].forEach(m);for(;++a<e-1;)h=c,c=n[s*e+a+1]>=r,p[c<<2|h<<3].forEach(m);function m(e){var t,n,r=[e[0][0]+a,e[0][1]+s],u=[e[1][0]+a,e[1][1]+s],l=o(r),c=o(u);(t=d[l])?(n=f[c])?(delete d[t.end],delete f[n.start],t===n?(t.ring.push(u),i(t.ring)):f[t.start]=d[n.end]={start:t.start,end:n.end,ring:t.ring.concat(n.ring)}):(delete d[t.end],t.ring.push(u),d[t.end=c]=t):(t=f[c])?(n=d[l])?(delete f[t.start],delete d[n.end],t===n?(t.ring.push(u),i(t.ring)):f[n.start]=d[t.end]={start:n.start,end:t.end,ring:n.ring.concat(t.ring)}):(delete f[t.start],t.ring.unshift(r),f[t.start=l]=t):f[l]=d[c]={start:l,end:c,ring:[r,u]}}p[c<<3].forEach(m)}(n,i,(e=>{r(e,n,i),function(e){var t=0,n=e.length,r=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];for(;++t<n;)r+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return r}(e)>0?a.push([e]):s.push(e)})),s.forEach((e=>{for(var t,n=0,r=a.length;n<r;++n)if(-1!==g((t=a[n])[0],e))return void t.push(e)})),{type:"MultiPolygon",value:i,coordinates:a}}function o(t){return 2*t[0]+t[1]*(e+1)*4}function s(n,r,i){n.forEach((n=>{var a,o=n[0],s=n[1],u=0|o,l=0|s,c=r[l*e+u];o>0&&o<e&&u===o&&(a=r[l*e+u-1],n[0]=o+(i-a)/(c-a)-.5),s>0&&s<t&&l===s&&(a=r[(l-1)*e+u],n[1]=s+(i-a)/(c-a)-.5)}))}return i.contour=a,i.size=function(r){if(!arguments.length)return[e,t];var a=Math.floor(r[0]),o=Math.floor(r[1]);return a>=0&&o>=0||n.error("invalid size"),e=a,t=o,i},i.smooth=function(e){return arguments.length?(r=e?s:d,i):r===s},i}function g(e,t){for(var n,r=-1,i=t.length;++r<i;)if(n=y(e,t[r]))return n;return 0}function y(e,t){for(var n=t[0],r=t[1],i=-1,a=0,o=e.length,s=o-1;a<o;s=a++){var u=e[a],l=u[0],c=u[1],h=e[s],f=h[0],d=h[1];if(v(u,h,t))return 0;c>r!=d>r&&n<(f-l)*(r-c)/(d-c)+l&&(i=-i)}return i}function v(e,t,n){var r,i,a,o;return function(e,t,n){return(t[0]-e[0])*(n[1]-e[1])==(n[0]-e[0])*(t[1]-e[1])}(e,t,n)&&(i=e[r=+(e[0]===t[0])],a=n[r],o=t[r],i<=a&&a<=o||o<=a&&a<=i)}function b(e,t,r){return function(i){var a=n.extent(i),o=r?Math.min(a[0],0):a[0],s=a[1],u=s-o,l=t?function(e,t,n){n=+n;const r=(t=+t)<(e=+e),i=r?c(t,e,n):c(e,t,n);return(r?-1:1)*(i<0?1/-i:i)}(o,s,e):u/(e+1);return f(o+l,s,l)}}function w(e){t.Transform.call(this,null,e)}function x(e,t,n,r,i){const a=e.x1||0,o=e.y1||0,s=t*n<0;function u(e){e.forEach(l)}function l(e){s&&e.reverse(),e.forEach(c)}function c(e){e[0]=(e[0]-a)*t+r,e[1]=(e[1]-o)*n+i}return function(e){return e.coordinates.forEach(u),e}}function M(e,t,n){const i=e>=0?e:r.bandwidthNRD(t,n);return Math.round((Math.sqrt(4*i*i+1)-1)/2)}function $(e){return n.isFunction(e)?e:n.constant(+e)}function E(){var e=e=>e[0],t=e=>e[1],r=n.one,i=[-1,-1],a=960,o=500,s=2;function u(n,u){const l=M(i[0],n,e)>>s,c=M(i[1],n,t)>>s,h=l?l+2:0,f=c?c+2:0,d=2*h+(a>>s),p=2*f+(o>>s),m=new Float32Array(d*p),g=new Float32Array(d*p);let y=m;n.forEach((n=>{const i=h+(+e(n)>>s),a=f+(+t(n)>>s);i>=0&&i<d&&a>=0&&a<p&&(m[i+a*d]+=+r(n))})),l>0&&c>0?(k(d,p,m,g,l),N(d,p,g,m,c),k(d,p,m,g,l),N(d,p,g,m,c),k(d,p,m,g,l),N(d,p,g,m,c)):l>0?(k(d,p,m,g,l),k(d,p,g,m,l),k(d,p,m,g,l),y=g):c>0&&(N(d,p,m,g,c),N(d,p,g,m,c),N(d,p,m,g,c),y=g);const v=u?Math.pow(2,-2*s):1/function(e,t){let n=0;for(let t of e)(t=+t)&&(n+=t);return n}(y);for(let e=0,t=d*p;e<t;++e)y[e]*=v;return{values:y,scale:1<<s,width:d,height:p,x1:h,y1:f,x2:h+(a>>s),y2:f+(o>>s)}}return u.x=function(t){return arguments.length?(e=$(t),u):e},u.y=function(e){return arguments.length?(t=$(e),u):t},u.weight=function(e){return arguments.length?(r=$(e),u):r},u.size=function(e){if(!arguments.length)return[a,o];var t=+e[0],r=+e[1];return t>=0&&r>=0||n.error("invalid size"),a=t,o=r,u},u.cellSize=function(e){return arguments.length?((e=+e)>=1||n.error("invalid cell size"),s=Math.floor(Math.log(e)/Math.LN2),u):1<<s},u.bandwidth=function(e){return arguments.length?(1===(e=n.array(e)).length&&(e=[+e[0],+e[0]]),2!==e.length&&n.error("invalid bandwidth"),i=e,u):i},u}function k(e,t,n,r,i){const a=1+(i<<1);for(let o=0;o<t;++o)for(let t=0,s=0;t<e+i;++t)t<e&&(s+=n[t+o*e]),t>=i&&(t>=a&&(s-=n[t-a+o*e]),r[t-i+o*e]=s/Math.min(t+1,e-1+a-t,a))}function N(e,t,n,r,i){const a=1+(i<<1);for(let o=0;o<e;++o)for(let s=0,u=0;s<t+i;++s)s<t&&(u+=n[o+s*e]),s>=i&&(s>=a&&(u-=n[o+(s-a)*e]),r[o+(s-i)*e]=u/Math.min(s+1,t-1+a-s,a))}function R(e){t.Transform.call(this,null,e)}w.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},n.inherits(w,t.Transform,{transform(e,r){if(this.value&&!r.changed()&&!e.modified())return r.StopPropagation;var i=r.fork(r.NO_SOURCE|r.NO_FIELDS),a=r.materialize(r.SOURCE).source,o=e.field||n.identity,s=m().smooth(!1!==e.smooth),u=e.thresholds||function(e,t,n){const r=b(n.levels||10,n.nice,!1!==n.zero);return"shared"!==n.resolve?r:r(e.map((e=>h(t(e).values))))}(a,o,e),l=null===e.as?null:e.as||"contour",c=[];return a.forEach((r=>{const i=o(r),a=s.size([i.width,i.height])(i.values,n.isArray(u)?u:u(i.values));!function(e,t,r,i){let a=i.scale||t.scale,o=i.translate||t.translate;n.isFunction(a)&&(a=a(r,i));n.isFunction(o)&&(o=o(r,i));if((1===a||null==a)&&!o)return;const s=(n.isNumber(a)?a:a[0])||1,u=(n.isNumber(a)?a:a[1])||1,l=o&&o[0]||0,c=o&&o[1]||0;e.forEach(x(t,s,u,l,c))}(a,i,r,e),a.forEach((e=>{c.push(t.rederive(r,t.ingest(null!=l?{[l]:e}:e)))}))})),this.value&&(i.rem=this.value),this.value=i.source=i.add=c,i}}),R.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const S=["x","y","weight","size","cellSize","bandwidth"];function j(e,t){return S.forEach((n=>null!=t[n]?e[n](t[n]):0)),e}function D(e){t.Transform.call(this,null,e)}n.inherits(R,t.Transform,{transform(e,r){if(this.value&&!r.changed()&&!e.modified())return r.StopPropagation;var i,a=r.fork(r.NO_SOURCE|r.NO_FIELDS),o=function(e,t){var n,r,i,a,o,s,u=[],l=e=>e(a);if(null==t)u.push(e);else for(n={},r=0,i=e.length;r<i;++r)a=e[r],(s=n[o=t.map(l)])||(n[o]=s=[],s.dims=o,u.push(s)),s.push(a);return u}(r.materialize(r.SOURCE).source,e.groupby),s=(e.groupby||[]).map(n.accessorName),u=j(E(),e),l=e.as||"grid";return i=o.map((n=>t.ingest(function(e,t){for(let n=0;n<s.length;++n)e[s[n]]=t[n];return e}({[l]:u(n,e.counts)},n.dims)))),this.value&&(a.rem=this.value),this.value=a.source=a.add=i,a}}),D.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},n.inherits(D,t.Transform,{transform(e,r){if(this.value&&!r.changed()&&!e.modified())return r.StopPropagation;var i,a,o=r.fork(r.NO_SOURCE|r.NO_FIELDS),s=m().smooth(!1!==e.smooth),u=e.values,l=e.thresholds||b(e.count||10,e.nice,!!u),c=e.size;return u||(u=r.materialize(r.SOURCE).source,a=x(i=j(E(),e)(u,!0),i.scale||1,i.scale||1,0,0),c=[i.width,i.height],u=i.values),l=n.isArray(l)?l:l(u),u=s.size(c)(u,l),a&&u.forEach(a),this.value&&(o.rem=this.value),this.value=o.source=o.add=(u||[]).map(t.ingest),o}});const z="Feature",O="FeatureCollection";function q(e){t.Transform.call(this,null,e)}function T(e){t.Transform.call(this,null,e)}function F(e){t.Transform.call(this,null,e)}function C(e){t.Transform.call(this,null,e)}q.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},n.inherits(q,t.Transform,{transform(e,t){var r,i=this._features,a=this._points,o=e.fields,s=o&&o[0],u=o&&o[1],l=e.geojson||!o&&n.identity,c=t.ADD;r=e.modified()||t.changed(t.REM)||t.modified(n.accessorFields(l))||s&&t.modified(n.accessorFields(s))||u&&t.modified(n.accessorFields(u)),this.value&&!r||(c=t.SOURCE,this._features=i=[],this._points=a=[]),l&&t.visit(c,(e=>i.push(l(e)))),s&&u&&(t.visit(c,(e=>{var t=s(e),n=u(e);null!=t&&null!=n&&(t=+t)===t&&(n=+n)===n&&a.push([t,n])})),i=i.concat({type:z,geometry:{type:"MultiPoint",coordinates:a}})),this.value={type:O,features:i}}}),T.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},n.inherits(T,t.Transform,{transform(e,t){var r=t.fork(t.ALL),a=this.value,o=e.field||n.identity,s=e.as||"path",u=r.SOURCE;!a||e.modified()?(this.value=a=i.getProjectionPath(e.projection),r.materialize().reflow()):u=o===n.identity||t.modified(o.fields)?r.ADD_MOD:r.ADD;const l=function(e,t){const n=e.pointRadius();e.context(null),null!=t&&e.pointRadius(t);return n}(a,e.pointRadius);return r.visit(u,(e=>e[s]=a(o(e)))),a.pointRadius(l),r.modifies(s)}}),F.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},n.inherits(F,t.Transform,{transform(e,t){var n,r=e.projection,i=e.fields[0],a=e.fields[1],o=e.as||["x","y"],s=o[0],u=o[1];function l(e){const t=r([i(e),a(e)]);t?(e[s]=t[0],e[u]=t[1]):(e[s]=void 0,e[u]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,l):(n=t.modified(i.fields)||t.modified(a.fields),t.visit(n?t.ADD_MOD:t.ADD,l)),t.modifies(o)}}),C.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},n.inherits(C,t.Transform,{transform(e,t){var r=t.fork(t.ALL),a=this.value,o=e.as||"shape",s=r.ADD;return a&&!e.modified()||(this.value=a=function(e,t,n){const r=null==n?n=>e(t(n)):r=>{var i=e.pointRadius(),a=e.pointRadius(n)(t(r));return e.pointRadius(i),a};return r.context=t=>(e.context(t),r),r}(i.getProjectionPath(e.projection),e.field||n.field("datum"),e.pointRadius),r.materialize().reflow(),s=r.SOURCE),r.visit(s,(e=>e[o]=a)),r.modifies(o)}});var P=1e-6,_=Math.abs,A=Math.ceil;function L(e,t,n){var r=f(e,t-P,n).concat(t);return function(e){return r.map((function(t){return[e,t]}))}}function U(e,t,n){var r=f(e,t-P,n).concat(t);return function(e){return r.map((function(t){return[t,e]}))}}function H(e){t.Transform.call(this,[],e),this.generator=function(){var e,t,n,r,i,a,o,s,u,l,c,h,d=10,p=d,m=90,g=360,y=2.5;function v(){return{type:"MultiLineString",coordinates:b()}}function b(){return f(A(r/m)*m,n,m).map(c).concat(f(A(s/g)*g,o,g).map(h)).concat(f(A(t/d)*d,e,d).filter((function(e){return _(e%m)>P})).map(u)).concat(f(A(a/p)*p,i,p).filter((function(e){return _(e%g)>P})).map(l))}return v.lines=function(){return b().map((function(e){return{type:"LineString",coordinates:e}}))},v.outline=function(){return{type:"Polygon",coordinates:[c(r).concat(h(o).slice(1),c(n).reverse().slice(1),h(s).reverse().slice(1))]}},v.extent=function(e){return arguments.length?v.extentMajor(e).extentMinor(e):v.extentMinor()},v.extentMajor=function(e){return arguments.length?(r=+e[0][0],n=+e[1][0],s=+e[0][1],o=+e[1][1],r>n&&(e=r,r=n,n=e),s>o&&(e=s,s=o,o=e),v.precision(y)):[[r,s],[n,o]]},v.extentMinor=function(n){return arguments.length?(t=+n[0][0],e=+n[1][0],a=+n[0][1],i=+n[1][1],t>e&&(n=t,t=e,e=n),a>i&&(n=a,a=i,i=n),v.precision(y)):[[t,a],[e,i]]},v.step=function(e){return arguments.length?v.stepMajor(e).stepMinor(e):v.stepMinor()},v.stepMajor=function(e){return arguments.length?(m=+e[0],g=+e[1],v):[m,g]},v.stepMinor=function(e){return arguments.length?(d=+e[0],p=+e[1],v):[d,p]},v.precision=function(f){return arguments.length?(y=+f,u=L(a,i,90),l=U(t,e,y),c=L(s,o,90),h=U(r,n,y),v):y},v.extentMajor([[-180,-90+P],[180,90-P]]).extentMinor([[-180,-80-P],[180,80+P]])}()}function I(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function G(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function J(){}H.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},n.inherits(H,t.Transform,{transform(e,r){var i,a=this.value,o=this.generator;if(!a.length||e.modified())for(const t in e)n.isFunction(o[t])&&o[t](e[t]);return i=o(),a.length?r.mod.push(t.replace(a[0],i)):r.add.push(t.ingest(i)),a[0]=i,r}});var K=.7,B=1/K,Q="\\s*([+-]?\\d+)\\s*",V="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",W="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",X=/^#([0-9a-f]{3,8})$/,Y=new RegExp(`^rgb\\(${Q},${Q},${Q}\\)$`),Z=new RegExp(`^rgb\\(${W},${W},${W}\\)$`),ee=new RegExp(`^rgba\\(${Q},${Q},${Q},${V}\\)$`),te=new RegExp(`^rgba\\(${W},${W},${W},${V}\\)$`),ne=new RegExp(`^hsl\\(${V},${W},${W}\\)$`),re=new RegExp(`^hsla\\(${V},${W},${W},${V}\\)$`),ie={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function ae(){return this.rgb().formatHex()}function oe(){return this.rgb().formatRgb()}function se(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=X.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?ue(t):3===n?new he(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?le(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?le(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Y.exec(e))?new he(t[1],t[2],t[3],1):(t=Z.exec(e))?new he(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=ee.exec(e))?le(t[1],t[2],t[3],t[4]):(t=te.exec(e))?le(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=ne.exec(e))?ye(t[1],t[2]/100,t[3]/100,1):(t=re.exec(e))?ye(t[1],t[2]/100,t[3]/100,t[4]):ie.hasOwnProperty(e)?ue(ie[e]):"transparent"===e?new he(NaN,NaN,NaN,0):null}function ue(e){return new he(e>>16&255,e>>8&255,255&e,1)}function le(e,t,n,r){return r<=0&&(e=t=n=NaN),new he(e,t,n,r)}function ce(e,t,n,r){return 1===arguments.length?((i=e)instanceof J||(i=se(i)),i?new he((i=i.rgb()).r,i.g,i.b,i.opacity):new he):new he(e,t,n,null==r?1:r);var i}function he(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function fe(){return`#${ge(this.r)}${ge(this.g)}${ge(this.b)}`}function de(){const e=pe(this.opacity);return`${1===e?"rgb(":"rgba("}${me(this.r)}, ${me(this.g)}, ${me(this.b)}${1===e?")":`, ${e})`}`}function pe(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function me(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function ge(e){return((e=me(e))<16?"0":"")+e.toString(16)}function ye(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new be(e,t,n,r)}function ve(e){if(e instanceof be)return new be(e.h,e.s,e.l,e.opacity);if(e instanceof J||(e=se(e)),!e)return new be;if(e instanceof be)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,u=(a+i)/2;return s?(o=t===a?(n-r)/s+6*(n<r):n===a?(r-t)/s+2:(t-n)/s+4,s/=u<.5?a+i:2-a-i,o*=60):s=u>0&&u<1?0:o,new be(o,s,u,e.opacity)}function be(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function we(e){return(e=(e||0)%360)<0?e+360:e}function xe(e){return Math.max(0,Math.min(1,e||0))}function Me(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function $e(e){t.Transform.call(this,null,e)}function Ee(e){if(!n.isFunction(e))return!1;const t=n.toSet(n.accessorFields(e));return t.$x||t.$y||t.$value||t.$max}function ke(e){t.Transform.call(this,null,e),this.modified(!0)}function Ne(e,t,r){n.isFunction(e[t])&&e[t](r)}I(J,se,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:ae,formatHex:ae,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return ve(this).formatHsl()},formatRgb:oe,toString:oe}),I(he,ce,G(J,{brighter(e){return e=null==e?B:Math.pow(B,e),new he(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?K:Math.pow(K,e),new he(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new he(me(this.r),me(this.g),me(this.b),pe(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:fe,formatHex:fe,formatHex8:function(){return`#${ge(this.r)}${ge(this.g)}${ge(this.b)}${ge(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:de,toString:de})),I(be,(function(e,t,n,r){return 1===arguments.length?ve(e):new be(e,t,n,null==r?1:r)}),G(J,{brighter(e){return e=null==e?B:Math.pow(B,e),new be(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?K:Math.pow(K,e),new be(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new he(Me(e>=240?e-240:e+120,i,r),Me(e,i,r),Me(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new be(we(this.h),xe(this.s),xe(this.l),pe(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=pe(this.opacity);return`${1===e?"hsl(":"hsla("}${we(this.h)}, ${100*xe(this.s)}%, ${100*xe(this.l)}%${1===e?")":`, ${e})`}`}})),$e.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},n.inherits($e,t.Transform,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var r=t.materialize(t.SOURCE).source,i="shared"===e.resolve,o=e.field||n.identity,s=function(e,t){let r;n.isFunction(e)?(r=n=>e(n,t),r.dep=Ee(e)):e?r=n.constant(e):(r=e=>e.$value/e.$max||0,r.dep=!0);return r}(e.opacity,e),u=function(e,t){let r;n.isFunction(e)?(r=n=>ce(e(n,t)),r.dep=Ee(e)):r=n.constant(ce(e||"#888"));return r}(e.color,e),l=e.as||"image",c={$x:0,$y:0,$value:0,$max:i?h(r.map((e=>h(o(e).values)))):0};return r.forEach((e=>{const t=o(e),r=n.extend({},e,c);i||(r.$max=h(t.values||[])),e[l]=function(e,t,r,i){const o=e.width,s=e.height,u=e.x1||0,l=e.y1||0,c=e.x2||o,h=e.y2||s,f=e.values,d=f?e=>f[e]:n.zero,p=a.canvas(c-u,h-l),m=p.getContext("2d"),g=m.getImageData(0,0,c-u,h-l),y=g.data;for(let e=l,n=0;e<h;++e){t.$y=e-l;for(let a=u,s=e*o;a<c;++a,n+=4){t.$x=a-u,t.$value=d(a+s);const e=r(t);y[n+0]=e.r,y[n+1]=e.g,y[n+2]=e.b,y[n+3]=~~(255*i(t))}}return m.putImageData(g,0,0),p}(t,r,u.dep?u:n.constant(u(r)),s.dep?s:n.constant(s(r)))})),t.reflow(!0).modifies(l)}}),n.inherits(ke,t.Transform,{transform(e,t){let r=this.value;return!r||e.modified("type")?(this.value=r=function(e){const t=i.projection((e||"mercator").toLowerCase());t||n.error("Unrecognized projection type: "+e);return t()}(e.type),i.projectionProperties.forEach((t=>{null!=e[t]&&Ne(r,t,e[t])}))):i.projectionProperties.forEach((t=>{e.modified(t)&&Ne(r,t,e[t])})),null!=e.pointRadius&&r.path.pointRadius(e.pointRadius),e.fit&&function(e,t){const r=function(e){return e=n.array(e),1===e.length?e[0]:{type:O,features:e.reduce(((e,t)=>e.concat(function(e){return e.type===O?e.features:n.array(e).filter((e=>null!=e)).map((e=>e.type===z?e:{type:z,geometry:e}))}(t))),[])}}(t.fit);t.extent?e.fitExtent(t.extent,r):t.size&&e.fitSize(t.size,r)}(r,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),e.contour=D,e.geojson=q,e.geopath=T,e.geopoint=F,e.geoshape=C,e.graticule=H,e.heatmap=$e,e.isocontour=w,e.kde2d=R,e.projection=ke}));
//# sourceMappingURL=vega-geo.min.js.map
