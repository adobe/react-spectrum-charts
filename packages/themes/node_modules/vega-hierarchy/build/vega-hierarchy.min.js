!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("vega-dataflow"),require("vega-util")):"function"==typeof define&&define.amd?define(["exports","vega-dataflow","vega-util"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).vega={},e.vega,e.vega)}(this,(function(e,n,t){"use strict";function r(e,n,t){const r={};return e.each((e=>{const i=e.data;t(i)&&(r[n(i)]=e)})),e.lookup=r,e}function i(e,n){return e.parent===n.parent?1:2}function a(e,n){return e+n.x}function o(e,n){return Math.max(e,n.y)}function u(e){var n=0,t=e.children,r=t&&t.length;if(r)for(;--r>=0;)n+=t[r].value;else n=1;e.value=n}function f(e,n){e instanceof Map?(e=[void 0,e],void 0===n&&(n=l)):void 0===n&&(n=c);for(var t,r,i,a,o,u=new d(e),f=[u];t=f.pop();)if((i=n(t.data))&&(o=(i=Array.from(i)).length))for(t.children=i,a=o-1;a>=0;--a)f.push(r=i[a]=new d(i[a])),r.parent=t,r.depth=t.depth+1;return u.eachBefore(s)}function c(e){return e.children}function l(e){return Array.isArray(e)?e[1]:null}function h(e){void 0!==e.data.value&&(e.value=e.data.value),e.data=e.data.data}function s(e){var n=0;do{e.height=n}while((e=e.parent)&&e.height<++n)}function d(e){this.data=e,this.depth=this.height=0,this.parent=null}function p(e){return null==e?null:y(e)}function y(e){if("function"!=typeof e)throw new Error;return e}function m(){return 0}function g(e){return function(){return e}}d.prototype=f.prototype={constructor:d,count:function(){return this.eachAfter(u)},each:function(e,n){let t=-1;for(const r of this)e.call(n,r,++t,this);return this},eachAfter:function(e,n){for(var t,r,i,a=this,o=[a],u=[],f=-1;a=o.pop();)if(u.push(a),t=a.children)for(r=0,i=t.length;r<i;++r)o.push(t[r]);for(;a=u.pop();)e.call(n,a,++f,this);return this},eachBefore:function(e,n){for(var t,r,i=this,a=[i],o=-1;i=a.pop();)if(e.call(n,i,++o,this),t=i.children)for(r=t.length-1;r>=0;--r)a.push(t[r]);return this},find:function(e,n){let t=-1;for(const r of this)if(e.call(n,r,++t,this))return r},sum:function(e){return this.eachAfter((function(n){for(var t=+e(n.data)||0,r=n.children,i=r&&r.length;--i>=0;)t+=r[i].value;n.value=t}))},sort:function(e){return this.eachBefore((function(n){n.children&&n.children.sort(e)}))},path:function(e){for(var n=this,t=function(e,n){if(e===n)return e;var t=e.ancestors(),r=n.ancestors(),i=null;e=t.pop(),n=r.pop();for(;e===n;)i=e,e=t.pop(),n=r.pop();return i}(n,e),r=[n];n!==t;)n=n.parent,r.push(n);for(var i=r.length;e!==t;)r.splice(i,0,e),e=e.parent;return r},ancestors:function(){for(var e=this,n=[e];e=e.parent;)n.push(e);return n},descendants:function(){return Array.from(this)},leaves:function(){var e=[];return this.eachBefore((function(n){n.children||e.push(n)})),e},links:function(){var e=this,n=[];return e.each((function(t){t!==e&&n.push({source:t.parent,target:t})})),n},copy:function(){return f(this).eachBefore(h)},[Symbol.iterator]:function*(){var e,n,t,r,i=this,a=[i];do{for(e=a.reverse(),a=[];i=e.pop();)if(yield i,n=i.children)for(t=0,r=n.length;t<r;++t)a.push(n[t])}while(a.length)}};const v=1664525,x=1013904223,w=4294967296;function z(e,n){var t,r;if(M(n,e))return[n];for(t=0;t<e.length;++t)if(b(n,e[t])&&M(B(e[t],n),e))return[e[t],n];for(t=0;t<e.length-1;++t)for(r=t+1;r<e.length;++r)if(b(B(e[t],e[r]),n)&&b(B(e[t],n),e[r])&&b(B(e[r],n),e[t])&&M(k(e[t],e[r],n),e))return[e[t],e[r],n];throw new Error}function b(e,n){var t=e.r-n.r,r=n.x-e.x,i=n.y-e.y;return t<0||t*t<r*r+i*i}function _(e,n){var t=e.r-n.r+1e-9*Math.max(e.r,n.r,1),r=n.x-e.x,i=n.y-e.y;return t>0&&t*t>r*r+i*i}function M(e,n){for(var t=0;t<n.length;++t)if(!_(e,n[t]))return!1;return!0}function A(e){switch(e.length){case 1:return function(e){return{x:e.x,y:e.y,r:e.r}}(e[0]);case 2:return B(e[0],e[1]);case 3:return k(e[0],e[1],e[2])}}function B(e,n){var t=e.x,r=e.y,i=e.r,a=n.x,o=n.y,u=n.r,f=a-t,c=o-r,l=u-i,h=Math.sqrt(f*f+c*c);return{x:(t+a+f/h*l)/2,y:(r+o+c/h*l)/2,r:(h+i+u)/2}}function k(e,n,t){var r=e.x,i=e.y,a=e.r,o=n.x,u=n.y,f=n.r,c=t.x,l=t.y,h=t.r,s=r-o,d=r-c,p=i-u,y=i-l,m=f-a,g=h-a,v=r*r+i*i-a*a,x=v-o*o-u*u+f*f,w=v-c*c-l*l+h*h,z=d*p-s*y,b=(p*w-y*x)/(2*z)-r,_=(y*m-p*g)/z,M=(d*x-s*w)/(2*z)-i,A=(s*g-d*m)/z,B=_*_+A*A-1,k=2*(a+b*_+M*A),T=b*b+M*M-a*a,q=-(Math.abs(B)>1e-6?(k+Math.sqrt(k*k-4*B*T))/(2*B):T/k);return{x:r+b+_*q,y:i+M+A*q,r:q}}function T(e,n,t){var r,i,a,o,u=e.x-n.x,f=e.y-n.y,c=u*u+f*f;c?(i=n.r+t.r,i*=i,o=e.r+t.r,i>(o*=o)?(r=(c+o-i)/(2*c),a=Math.sqrt(Math.max(0,o/c-r*r)),t.x=e.x-r*u-a*f,t.y=e.y-r*f+a*u):(r=(c+i-o)/(2*c),a=Math.sqrt(Math.max(0,i/c-r*r)),t.x=n.x+r*u-a*f,t.y=n.y+r*f+a*u)):(t.x=n.x+t.r,t.y=n.y)}function q(e,n){var t=e.r+n.r-1e-6,r=n.x-e.x,i=n.y-e.y;return t>0&&t*t>r*r+i*i}function D(e){var n=e._,t=e.next._,r=n.r+t.r,i=(n.x*t.r+t.x*n.r)/r,a=(n.y*t.r+t.y*n.r)/r;return i*i+a*a}function E(e){this._=e,this.next=null,this.previous=null}function O(e,n){if(!(o=(t=e,e="object"==typeof t&&"length"in t?t:Array.from(t)).length))return 0;var t,r,i,a,o,u,f,c,l,h,s,d;if((r=e[0]).x=0,r.y=0,!(o>1))return r.r;if(i=e[1],r.x=-i.r,i.x=r.r,i.y=0,!(o>2))return r.r+i.r;T(i,r,a=e[2]),r=new E(r),i=new E(i),a=new E(a),r.next=a.previous=i,i.next=r.previous=a,a.next=i.previous=r;e:for(c=3;c<o;++c){T(r._,i._,a=e[c]),a=new E(a),l=i.next,h=r.previous,s=i._.r,d=r._.r;do{if(s<=d){if(q(l._,a._)){i=l,r.next=i,i.previous=r,--c;continue e}s+=l._.r,l=l.next}else{if(q(h._,a._)){(r=h).next=i,i.previous=r,--c;continue e}d+=h._.r,h=h.previous}}while(l!==h.next);for(a.previous=r,a.next=i,r.next=i.previous=i=a,u=D(r);(a=a.next)!==i;)(f=D(a))<u&&(r=a,u=f);i=r.next}for(r=[i._],a=i;(a=a.next)!==i;)r.push(a._);for(a=function(e,n){for(var t,r,i=0,a=(e=function(e,n){let t,r,i=e.length;for(;i;)r=n()*i--|0,t=e[i],e[i]=e[r],e[r]=t;return e}(Array.from(e),n)).length,o=[];i<a;)t=e[i],r&&_(r,t)?++i:(r=A(o=z(o,t)),i=0);return r}(r,n),c=0;c<o;++c)(r=e[c]).x-=a.x,r.y-=a.y;return a.r}function S(e){return Math.sqrt(e.value)}function R(e){return function(n){n.children||(n.r=Math.max(0,+e(n)||0))}}function I(e,n,t){return function(r){if(i=r.children){var i,a,o,u=i.length,f=e(r)*n||0;if(f)for(a=0;a<u;++a)i[a].r+=f;if(o=O(i,t),f)for(a=0;a<u;++a)i[a].r-=f;r.r=o+f}}}function L(e){return function(n){var t=n.parent;n.r*=e,t&&(n.x=t.x+e*n.x,n.y=t.y+e*n.y)}}function U(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function C(e,n,t,r,i){for(var a,o=e.children,u=-1,f=o.length,c=e.value&&(r-n)/e.value;++u<f;)(a=o[u]).y0=t,a.y1=i,a.x0=n,a.x1=n+=a.value*c}var P={depth:-1},j={},K={};function N(e){return e.id}function $(e){return e.parentId}function F(){var e,n=N,t=$;function r(r){var i,a,o,u,f,c,l,h,p=Array.from(r),y=n,m=t,g=new Map;if(null!=e){const n=p.map(((n,t)=>function(e){e=`${e}`;let n=e.length;H(e,n-1)&&!H(e,n-2)&&(e=e.slice(0,-1));return"/"===e[0]?e:`/${e}`}(e(n,t,r)))),t=n.map(G),i=new Set(n).add("");for(const e of t)i.has(e)||(i.add(e),n.push(e),t.push(G(e)),p.push(K));y=(e,t)=>n[t],m=(e,n)=>t[n]}for(o=0,i=p.length;o<i;++o)a=p[o],c=p[o]=new d(a),null!=(l=y(a,o,r))&&(l+="")&&(h=c.id=l,g.set(h,g.has(h)?j:c)),null!=(l=m(a,o,r))&&(l+="")&&(c.parent=l);for(o=0;o<i;++o)if(l=(c=p[o]).parent){if(!(f=g.get(l)))throw new Error("missing: "+l);if(f===j)throw new Error("ambiguous: "+l);f.children?f.children.push(c):f.children=[c],c.parent=f}else{if(u)throw new Error("multiple roots");u=c}if(!u)throw new Error("no root");if(null!=e){for(;u.data===K&&1===u.children.length;)u=u.children[0],--i;for(let e=p.length-1;e>=0&&(c=p[e]).data===K;--e)c.data=null}if(u.parent=P,u.eachBefore((function(e){e.depth=e.parent.depth+1,--i})).eachBefore(s),u.parent=null,i>0)throw new Error("cycle");return u}return r.id=function(e){return arguments.length?(n=p(e),r):n},r.parentId=function(e){return arguments.length?(t=p(e),r):t},r.path=function(n){return arguments.length?(e=p(n),r):e},r}function G(e){let n=e.length;if(n<2)return"";for(;--n>1&&!H(e,n););return e.slice(0,n)}function H(e,n){if("/"===e[n]){let t=0;for(;n>0&&"\\"===e[--n];)++t;if(0==(1&t))return!0}return!1}function J(e,n){return e.parent===n.parent?1:2}function Q(e){var n=e.children;return n?n[0]:e.t}function V(e){var n=e.children;return n?n[n.length-1]:e.t}function W(e,n,t){var r=t/(n.i-e.i);n.c-=r,n.s+=t,e.c+=r,n.z+=t,n.m+=t}function X(e,n,t){return e.a.parent===n.parent?e.a:t}function Y(e,n){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=n}function Z(e,n,t,r,i){for(var a,o=e.children,u=-1,f=o.length,c=e.value&&(i-t)/e.value;++u<f;)(a=o[u]).x0=n,a.x1=r,a.y0=t,a.y1=t+=a.value*c}Y.prototype=Object.create(d.prototype);var ee=(1+Math.sqrt(5))/2;function ne(e,n,t,r,i,a){for(var o,u,f,c,l,h,s,d,p,y,m,g=[],v=n.children,x=0,w=0,z=v.length,b=n.value;x<z;){f=i-t,c=a-r;do{l=v[w++].value}while(!l&&w<z);for(h=s=l,m=l*l*(y=Math.max(c/f,f/c)/(b*e)),p=Math.max(s/m,m/h);w<z;++w){if(l+=u=v[w].value,u<h&&(h=u),u>s&&(s=u),m=l*l*y,(d=Math.max(s/m,m/h))>p){l-=u;break}p=d}g.push(o={value:l,dice:f<c,children:v.slice(x,w)}),o.dice?C(o,t,r,i,b?r+=c*l/b:a):Z(o,t,r,b?t+=f*l/b:i,a),b-=l,x=w}return g}var te=function e(n){function t(e,t,r,i,a){ne(n,e,t,r,i,a)}return t.ratio=function(n){return e((n=+n)>1?n:1)},t}(ee);var re=function e(n){function t(e,t,r,i,a){if((o=e._squarify)&&o.ratio===n)for(var o,u,f,c,l,h=-1,s=o.length,d=e.value;++h<s;){for(f=(u=o[h]).children,c=u.value=0,l=f.length;c<l;++c)u.value+=f[c].value;u.dice?C(u,t,r,i,d?r+=(a-r)*u.value/d:a):Z(u,t,r,d?t+=(i-t)*u.value/d:i,a),d-=u.value}else e._squarify=o=ne(n,e,t,r,i,a),o.ratio=n}return t.ratio=function(n){return e((n=+n)>1?n:1)},t}(ee);function ie(e){n.Transform.call(this,null,e)}ie.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const ae=e=>e.values;function oe(){const e=[],n={entries:e=>r(t(e,0),0),key:t=>(e.push(t),n)};function t(n,r){if(r>=e.length)return n;const i=n.length,a=e[r++],o={},u={};let f,c,l,h=-1;for(;++h<i;)f=a(c=n[h])+"",(l=o[f])?l.push(c):o[f]=[c];for(f in o)u[f]=t(o[f],r);return u}function r(n,t){if(++t>e.length)return n;const i=[];for(const e in n)i.push({key:e,values:r(n[e],t)});return i}return n}function ue(e){n.Transform.call(this,null,e)}t.inherits(ie,n.Transform,{transform(e,i){i.source||t.error("Nest transform requires an upstream data source.");var a=e.generate,o=e.modified(),u=i.clone(),c=this.value;return(!c||o||i.changed())&&(c&&c.each((e=>{e.children&&n.isTuple(e.data)&&u.rem.push(e.data)})),this.value=c=f({values:t.array(e.keys).reduce(((e,n)=>(e.key(n),e)),oe()).entries(u.source)},ae),a&&c.each((e=>{e.children&&(e=n.ingest(e.data),u.add.push(e),u.source.push(e))})),r(c,n.tupleid,n.tupleid)),u.source.root=c,u}});const fe=(e,n)=>e.parent===n.parent?1:2;t.inherits(ue,n.Transform,{transform(e,r){r.source&&r.source.root||t.error(this.constructor.name+" transform requires a backing tree data source.");const i=this.layout(e.method),a=this.fields,o=r.source.root,u=e.as||a;e.field?o.sum(e.field):o.count(),e.sort&&o.sort(n.stableCompare(e.sort,(e=>e.data))),function(e,n,t){for(let r,i=0,a=n.length;i<a;++i)r=n[i],r in t&&e[r](t[r])}(i,this.params,e),i.separation&&i.separation(!1!==e.separation?fe:t.one);try{this.value=i(o)}catch(e){t.error(e)}return o.each((e=>function(e,n,t){const r=e.data,i=n.length-1;for(let a=0;a<i;++a)r[t[a]]=e[n[a]];r[t[i]]=e.children?e.children.length:0}(e,a,u))),r.reflow(e.modified()).modifies(u).modifies("leaf")}});const ce=["x","y","r","depth","children"];function le(e){ue.call(this,e)}le.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:ce.length,default:ce}]},t.inherits(le,ue,{layout:function(){var e=null,n=1,t=1,r=m;function i(i){const a=function(){let e=1;return()=>(e=(v*e+x)%w)/w}();return i.x=n/2,i.y=t/2,e?i.eachBefore(R(e)).eachAfter(I(r,.5,a)).eachBefore(L(1)):i.eachBefore(R(S)).eachAfter(I(m,1,a)).eachAfter(I(r,i.r/Math.min(n,t),a)).eachBefore(L(Math.min(n,t)/(2*i.r))),i}return i.radius=function(n){return arguments.length?(e=p(n),i):e},i.size=function(e){return arguments.length?(n=+e[0],t=+e[1],i):[n,t]},i.padding=function(e){return arguments.length?(r="function"==typeof e?e:g(+e),i):r},i},params:["radius","size","padding"],fields:ce});const he=["x0","y0","x1","y1","depth","children"];function se(e){ue.call(this,e)}function de(e){n.Transform.call(this,null,e)}se.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:he.length,default:he}]},t.inherits(se,ue,{layout:function(){var e=1,n=1,t=0,r=!1;function i(i){var a=i.height+1;return i.x0=i.y0=t,i.x1=e,i.y1=n/a,i.eachBefore(function(e,n){return function(r){r.children&&C(r,r.x0,e*(r.depth+1)/n,r.x1,e*(r.depth+2)/n);var i=r.x0,a=r.y0,o=r.x1-t,u=r.y1-t;o<i&&(i=o=(i+o)/2),u<a&&(a=u=(a+u)/2),r.x0=i,r.y0=a,r.x1=o,r.y1=u}}(n,a)),r&&i.eachBefore(U),i}return i.round=function(e){return arguments.length?(r=!!e,i):r},i.size=function(t){return arguments.length?(e=+t[0],n=+t[1],i):[e,n]},i.padding=function(e){return arguments.length?(t=+e,i):t},i},params:["size","round","padding"],fields:he}),de.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},t.inherits(de,n.Transform,{transform(e,n){n.source||t.error("Stratify transform requires an upstream data source.");let i=this.value;const a=e.modified(),o=n.fork(n.ALL).materialize(n.SOURCE),u=!i||a||n.changed(n.ADD_REM)||n.modified(e.key.fields)||n.modified(e.parentKey.fields);return o.source=o.source.slice(),u&&(i=o.source.length?r(F().id(e.key).parentId(e.parentKey)(o.source),e.key,t.truthy):r(F()([{}]),e.key,e.key)),o.source.root=this.value=i,o}});const pe={tidy:function(){var e=J,n=1,t=1,r=null;function i(i){var f=function(e){for(var n,t,r,i,a,o=new Y(e,0),u=[o];n=u.pop();)if(r=n._.children)for(n.children=new Array(a=r.length),i=a-1;i>=0;--i)u.push(t=n.children[i]=new Y(r[i],i)),t.parent=n;return(o.parent=new Y(null,0)).children=[o],o}(i);if(f.eachAfter(a),f.parent.m=-f.z,f.eachBefore(o),r)i.eachBefore(u);else{var c=i,l=i,h=i;i.eachBefore((function(e){e.x<c.x&&(c=e),e.x>l.x&&(l=e),e.depth>h.depth&&(h=e)}));var s=c===l?1:e(c,l)/2,d=s-c.x,p=n/(l.x+s+d),y=t/(h.depth||1);i.eachBefore((function(e){e.x=(e.x+d)*p,e.y=e.depth*y}))}return i}function a(n){var t=n.children,r=n.parent.children,i=n.i?r[n.i-1]:null;if(t){!function(e){for(var n,t=0,r=0,i=e.children,a=i.length;--a>=0;)(n=i[a]).z+=t,n.m+=t,t+=n.s+(r+=n.c)}(n);var a=(t[0].z+t[t.length-1].z)/2;i?(n.z=i.z+e(n._,i._),n.m=n.z-a):n.z=a}else i&&(n.z=i.z+e(n._,i._));n.parent.A=function(n,t,r){if(t){for(var i,a=n,o=n,u=t,f=a.parent.children[0],c=a.m,l=o.m,h=u.m,s=f.m;u=V(u),a=Q(a),u&&a;)f=Q(f),(o=V(o)).a=n,(i=u.z+h-a.z-c+e(u._,a._))>0&&(W(X(u,n,r),n,i),c+=i,l+=i),h+=u.m,c+=a.m,s+=f.m,l+=o.m;u&&!V(o)&&(o.t=u,o.m+=h-l),a&&!Q(f)&&(f.t=a,f.m+=c-s,r=n)}return r}(n,i,n.parent.A||r[0])}function o(e){e._.x=e.z+e.parent.m,e.m+=e.parent.m}function u(e){e.x*=n,e.y=e.depth*t}return i.separation=function(n){return arguments.length?(e=n,i):e},i.size=function(e){return arguments.length?(r=!1,n=+e[0],t=+e[1],i):r?null:[n,t]},i.nodeSize=function(e){return arguments.length?(r=!0,n=+e[0],t=+e[1],i):r?[n,t]:null},i},cluster:function(){var e=i,n=1,t=1,r=!1;function u(i){var u,f=0;i.eachAfter((function(n){var t=n.children;t?(n.x=function(e){return e.reduce(a,0)/e.length}(t),n.y=function(e){return 1+e.reduce(o,0)}(t)):(n.x=u?f+=e(n,u):0,n.y=0,u=n)}));var c=function(e){for(var n;n=e.children;)e=n[0];return e}(i),l=function(e){for(var n;n=e.children;)e=n[n.length-1];return e}(i),h=c.x-e(c,l)/2,s=l.x+e(l,c)/2;return i.eachAfter(r?function(e){e.x=(e.x-i.x)*n,e.y=(i.y-e.y)*t}:function(e){e.x=(e.x-h)/(s-h)*n,e.y=(1-(i.y?e.y/i.y:1))*t})}return u.separation=function(n){return arguments.length?(e=n,u):e},u.size=function(e){return arguments.length?(r=!1,n=+e[0],t=+e[1],u):r?null:[n,t]},u.nodeSize=function(e){return arguments.length?(r=!0,n=+e[0],t=+e[1],u):r?[n,t]:null},u}},ye=["x","y","depth","children"];function me(e){ue.call(this,e)}function ge(e){n.Transform.call(this,[],e)}me.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:ye.length,default:ye}]},t.inherits(me,ue,{layout(e){const n=e||"tidy";if(t.hasOwnProperty(pe,n))return pe[n]();t.error("Unrecognized Tree layout method: "+n)},params:["size","nodeSize"],fields:ye}),ge.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},t.inherits(ge,n.Transform,{transform(e,r){const i=this.value,a=r.source&&r.source.root,o=r.fork(r.NO_SOURCE),u={};return a||t.error("TreeLinks transform requires a tree data source."),r.changed(r.ADD_REM)?(o.rem=i,r.visit(r.SOURCE,(e=>u[n.tupleid(e)]=1)),a.each((e=>{const t=e.data,r=e.parent&&e.parent.data;r&&u[n.tupleid(t)]&&u[n.tupleid(r)]&&o.add.push(n.ingest({source:r,target:t}))})),this.value=o.add):r.changed(r.MOD)&&(r.visit(r.MOD,(e=>u[n.tupleid(e)]=1)),i.forEach((e=>{(u[n.tupleid(e.source)]||u[n.tupleid(e.target)])&&o.mod.push(e)}))),o}});const ve={binary:function(e,n,t,r,i){var a,o,u=e.children,f=u.length,c=new Array(f+1);for(c[0]=o=a=0;a<f;++a)c[a+1]=o+=u[a].value;!function e(n,t,r,i,a,o,f){if(n>=t-1){var l=u[n];return l.x0=i,l.y0=a,l.x1=o,void(l.y1=f)}var h=c[n],s=r/2+h,d=n+1,p=t-1;for(;d<p;){var y=d+p>>>1;c[y]<s?d=y+1:p=y}s-c[d-1]<c[d]-s&&n+1<d&&--d;var m=c[d]-h,g=r-m;if(o-i>f-a){var v=r?(i*g+o*m)/r:o;e(n,d,m,i,a,v,f),e(d,t,g,v,a,o,f)}else{var x=r?(a*g+f*m)/r:f;e(n,d,m,i,a,o,x),e(d,t,g,i,x,o,f)}}(0,f,e.value,n,t,r,i)},dice:C,slice:Z,slicedice:function(e,n,t,r,i){(1&e.depth?Z:C)(e,n,t,r,i)},squarify:te,resquarify:re},xe=["x0","y0","x1","y1","depth","children"];function we(e){ue.call(this,e)}we.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:xe.length,default:xe}]},t.inherits(we,ue,{layout(){const e=function(){var e=te,n=!1,t=1,r=1,i=[0],a=m,o=m,u=m,f=m,c=m;function l(e){return e.x0=e.y0=0,e.x1=t,e.y1=r,e.eachBefore(h),i=[0],n&&e.eachBefore(U),e}function h(n){var t=i[n.depth],r=n.x0+t,l=n.y0+t,h=n.x1-t,s=n.y1-t;h<r&&(r=h=(r+h)/2),s<l&&(l=s=(l+s)/2),n.x0=r,n.y0=l,n.x1=h,n.y1=s,n.children&&(t=i[n.depth+1]=a(n)/2,r+=c(n)-t,l+=o(n)-t,(h-=u(n)-t)<r&&(r=h=(r+h)/2),(s-=f(n)-t)<l&&(l=s=(l+s)/2),e(n,r,l,h,s))}return l.round=function(e){return arguments.length?(n=!!e,l):n},l.size=function(e){return arguments.length?(t=+e[0],r=+e[1],l):[t,r]},l.tile=function(n){return arguments.length?(e=y(n),l):e},l.padding=function(e){return arguments.length?l.paddingInner(e).paddingOuter(e):l.paddingInner()},l.paddingInner=function(e){return arguments.length?(a="function"==typeof e?e:g(+e),l):a},l.paddingOuter=function(e){return arguments.length?l.paddingTop(e).paddingRight(e).paddingBottom(e).paddingLeft(e):l.paddingTop()},l.paddingTop=function(e){return arguments.length?(o="function"==typeof e?e:g(+e),l):o},l.paddingRight=function(e){return arguments.length?(u="function"==typeof e?e:g(+e),l):u},l.paddingBottom=function(e){return arguments.length?(f="function"==typeof e?e:g(+e),l):f},l.paddingLeft=function(e){return arguments.length?(c="function"==typeof e?e:g(+e),l):c},l}();return e.ratio=n=>{const t=e.tile();t.ratio&&e.tile(t.ratio(n))},e.method=n=>{t.hasOwnProperty(ve,n)?e.tile(ve[n]):t.error("Unrecognized Treemap layout method: "+n)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:xe}),e.nest=ie,e.pack=le,e.partition=se,e.stratify=de,e.tree=me,e.treelinks=ge,e.treemap=we}));
//# sourceMappingURL=vega-hierarchy.min.js.map
