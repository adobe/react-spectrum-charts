!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vega-util"),require("vega-expression")):"function"==typeof define&&define.amd?define(["exports","vega-util","vega-expression"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).vega={},e.vega,e.vega)}(this,(function(e,t,n){"use strict";function r(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function i(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function u(){return 0}class o extends Set{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l;if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),null!=e)for(const t of e)this.add(t)}has(e){return super.has(function(e,t){let{_intern:n,_key:r}=e;const i=r(t);return n.has(i)?n.get(i):t}(this,e))}add(e){return super.add(function(e,t){let{_intern:n,_key:r}=e;const i=r(t);return n.has(i)?n.get(i):(n.set(i,t),t)}(this,e))}delete(e){return super.delete(function(e,t){let{_intern:n,_key:r}=e;const i=r(t);n.has(i)&&(t=n.get(i),n.delete(i));return t}(this,e))}}function l(e){return null!==e&&"object"==typeof e?e.valueOf():e}function s(e){return e instanceof o?e:new o(e)}const f=Symbol("vega_selection_getter");function a(e){return e.getter&&e.getter[f]||(e.getter=t.field(e.field),e.getter[f]=!0),e.getter}const c="intersect",d="union",g="_vgsid_",h=t.field(g),v="E",p="R",y="R-E",_="R-LE",m="R-RE",b="E-LT",N="E-LTE",E="E-GT",x="E-GTE",w="E-VALID",O="E-ONE",R="index:unit";function T(e,n){for(var r,i,u=n.fields,o=n.values,l=u.length,s=0;s<l;++s)if(r=a(i=u[s])(e),t.isDate(r)&&(r=t.toNumber(r)),t.isDate(o[s])&&(o[s]=t.toNumber(o[s])),t.isArray(o[s])&&t.isDate(o[s][0])&&(o[s]=o[s].map(t.toNumber)),i.type===v){if(t.isArray(o[s])?!o[s].includes(r):r!==o[s])return!1}else if(i.type===p){if(!t.inrange(r,o[s]))return!1}else if(i.type===m){if(!t.inrange(r,o[s],!0,!1))return!1}else if(i.type===y){if(!t.inrange(r,o[s],!1,!1))return!1}else if(i.type===_){if(!t.inrange(r,o[s],!1,!0))return!1}else if(i.type===b){if(r>=o[s])return!1}else if(i.type===N){if(r>o[s])return!1}else if(i.type===E){if(r<=o[s])return!1}else if(i.type===x){if(r<o[s])return!1}else if(i.type===w){if(null===r||isNaN(r))return!1}else if(i.type===O&&-1===o[s].indexOf(r))return!1;return!0}const k=function(e){let t,n,o;function l(e,r){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length;if(i<u){if(0!==t(r,r))return u;do{const t=i+u>>>1;n(e[t],r)<0?i=t+1:u=t}while(i<u)}return i}return 2!==e.length?(t=r,n=(t,n)=>r(e(t),n),o=(t,n)=>e(t)-n):(t=e===r||e===i?e:u,n=e,o=e),{left:l,center:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=l(e,t,n,(arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length)-1);return r>n&&o(e[r-1],t)>-o(e[r],t)?r-1:r},right:function(e,r){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length;if(i<u){if(0!==t(r,r))return u;do{const t=i+u>>>1;n(e[t],r)<=0?i=t+1:u=t}while(i<u)}return i}}}(h),j=k.left,$=k.right;var A={[`${g}_union`]:function(){const e=new o;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const t of n)for(const n of t)e.add(n);return e},[`${g}_intersect`]:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];e=new o(e),n=n.map(s);e:for(const t of e)for(const r of n)if(!r.has(t)){e.delete(t);continue e}return e},E_union:function(e,t){if(!e.length)return t;for(var n=0,r=t.length;n<r;++n)e.includes(t[n])||e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter((e=>t.includes(e))):t},R_union:function(e,n){var r=t.toNumber(n[0]),i=t.toNumber(n[1]);return r>i&&(r=n[1],i=n[0]),e.length?(e[0]>r&&(e[0]=r),e[1]<i&&(e[1]=i),e):[r,i]},R_intersect:function(e,n){var r=t.toNumber(n[0]),i=t.toNumber(n[1]);return r>i&&(r=n[1],i=n[0]),e.length?i<e[0]||e[1]<r?[]:(e[0]<r&&(e[0]=r),e[1]>i&&(e[1]=i),e):[r,i]}};e.selectionIdTest=function(e,t,n){const r=this.context.data[e],i=r?r.values.value:[],u=r?r[R]&&r[R].value:void 0,o=n===c,l=h(t),s=j(i,l);if(s===i.length)return!1;if(h(i[s])!==l)return!1;if(u&&o){if(1===u.size)return!0;if($(i,l)-s<u.size)return!1}return!0},e.selectionResolve=function(e,n,r,i){for(var u,o,l,s,f,a,c,v,p,y,_,m,b=this.context.data[e],N=b?b.values.value:[],E={},x={},w={},O=N.length,R=0;R<O;++R)if(s=(u=N[R]).unit,o=u.fields,l=u.values,o&&l){for(_=0,m=o.length;_<m;++_)f=o[_],v=(c=E[f.field]||(E[f.field]={}))[s]||(c[s]=[]),w[f.field]=p=f.type.charAt(0),y=A[`${p}_union`],c[s]=y(v,t.array(l[_]));r&&(v=x[s]||(x[s]=[])).push(t.array(l).reduce(((e,t,n)=>(e[o[n].field]=t,e)),{}))}else f=g,a=h(u),(v=(c=E[f]||(E[f]={}))[s]||(c[s]=[])).push(a),r&&(v=x[s]||(x[s]=[])).push({[g]:a});if(n=n||d,E[g]?E[g]=A[`${g}_${n}`](...Object.values(E[g])):Object.keys(E).forEach((e=>{E[e]=Object.keys(E[e]).map((t=>E[e][t])).reduce(((t,r)=>void 0===t?r:A[`${w[e]}_${n}`](t,r)))})),N=Object.keys(x),r&&N.length){E[i?"vlPoint":"vlMulti"]=n===d?{or:N.reduce(((e,t)=>(e.push(...x[t]),e)),[])}:{and:N.map((e=>({or:x[e]})))}}return E},e.selectionTest=function(e,t,n){for(var r,i,u,o,l,s=this.context.data[e],f=s?s.values.value:[],a=s?s[R]&&s[R].value:void 0,d=n===c,g=f.length,h=0;h<g;++h)if(r=f[h],a&&d){if(-1===(u=(i=i||{})[o=r.unit]||0))continue;if(l=T(t,r),i[o]=l?-1:++u,l&&1===a.size)return!0;if(!l&&u===a.get(o).count)return!1}else if(d^(l=T(t,r)))return l;return g&&d},e.selectionTuples=function(e,n){return e.map((e=>t.extend(n.fields?{values:n.fields.map((t=>a(t)(e.datum)))}:{[g]:h(e.datum)},n)))},e.selectionVisitor=function(e,r,i,u){r[0].type!==n.Literal&&t.error("First argument to selection functions must be a string literal.");const o=r[0].value,l="unit",s="@"+l,f=":"+o;(r.length>=2&&t.peek(r).value)!==c||t.hasOwnProperty(u,s)||(u[s]=i.getData(o).indataRef(i,l)),t.hasOwnProperty(u,f)||(u[f]=i.getData(o).tuplesRef())}}));
//# sourceMappingURL=vega-selection.min.js.map
