{"version":3,"file":"vega-force.js","sources":["../src/Force.js"],"sourcesContent":["import {Transform} from 'vega-dataflow';\nimport {\n  accessorFields, array, error, hasOwnProperty,\n  inherits, isFunction\n} from 'vega-util';\nimport {\n  forceCenter, forceCollide, forceLink,\n  forceManyBody, forceSimulation, forceX, forceY\n} from 'd3-force';\n\nconst ForceMap = {\n  center: forceCenter,\n  collide: forceCollide,\n  nbody: forceManyBody,\n  link: forceLink,\n  x: forceX,\n  y: forceY\n};\n\nconst Forces = 'forces',\n      ForceParams = [\n        'alpha', 'alphaMin', 'alphaTarget',\n        'velocityDecay', 'forces'\n      ],\n      ForceConfig = ['static', 'iterations'],\n      ForceOutput = ['x', 'y', 'vx', 'vy'];\n\n/**\n * Force simulation layout.\n * @constructor\n * @param {object} params - The parameters for this operator.\n * @param {Array<object>} params.forces - The forces to apply.\n */\nexport default function Force(params) {\n  Transform.call(this, null, params);\n}\n\nForce.Definition = {\n  'type': 'Force',\n  'metadata': {'modifies': true},\n  'params': [\n    { 'name': 'static', 'type': 'boolean', 'default': false },\n    { 'name': 'restart', 'type': 'boolean', 'default': false },\n    { 'name': 'iterations', 'type': 'number', 'default': 300 },\n    { 'name': 'alpha', 'type': 'number', 'default': 1 },\n    { 'name': 'alphaMin', 'type': 'number', 'default': 0.001 },\n    { 'name': 'alphaTarget', 'type': 'number', 'default': 0 },\n    { 'name': 'velocityDecay', 'type': 'number', 'default': 0.4 },\n    { 'name': 'forces', 'type': 'param', 'array': true,\n      'params': [\n        {\n          'key': {'force': 'center'},\n          'params': [\n            { 'name': 'x', 'type': 'number', 'default': 0 },\n            { 'name': 'y', 'type': 'number', 'default': 0 }\n          ]\n        },\n        {\n          'key': {'force': 'collide'},\n          'params': [\n            { 'name': 'radius', 'type': 'number', 'expr': true },\n            { 'name': 'strength', 'type': 'number', 'default': 0.7 },\n            { 'name': 'iterations', 'type': 'number', 'default': 1 }\n          ]\n        },\n        {\n          'key': {'force': 'nbody'},\n          'params': [\n            { 'name': 'strength', 'type': 'number', 'default': -30, 'expr': true },\n            { 'name': 'theta', 'type': 'number', 'default': 0.9 },\n            { 'name': 'distanceMin', 'type': 'number', 'default': 1 },\n            { 'name': 'distanceMax', 'type': 'number' }\n          ]\n        },\n        {\n          'key': {'force': 'link'},\n          'params': [\n            { 'name': 'links', 'type': 'data' },\n            { 'name': 'id', 'type': 'field' },\n            { 'name': 'distance', 'type': 'number', 'default': 30, 'expr': true },\n            { 'name': 'strength', 'type': 'number', 'expr': true },\n            { 'name': 'iterations', 'type': 'number', 'default': 1 }\n          ]\n        },\n        {\n          'key': {'force': 'x'},\n          'params': [\n            { 'name': 'strength', 'type': 'number', 'default': 0.1 },\n            { 'name': 'x', 'type': 'field' }\n          ]\n        },\n        {\n          'key': {'force': 'y'},\n          'params': [\n            { 'name': 'strength', 'type': 'number', 'default': 0.1 },\n            { 'name': 'y', 'type': 'field' }\n          ]\n        }\n      ] },\n    {\n      'name': 'as', 'type': 'string', 'array': true, 'modify': false,\n      'default': ForceOutput\n    }\n  ]\n};\n\ninherits(Force, Transform, {\n  transform(_, pulse) {\n    var sim = this.value,\n        change = pulse.changed(pulse.ADD_REM),\n        params = _.modified(ForceParams),\n        iters = _.iterations || 300;\n\n    // configure simulation\n    if (!sim) {\n      this.value = sim = simulation(pulse.source, _);\n      sim.on('tick', rerun(pulse.dataflow, this));\n      if (!_.static) {\n        change = true;\n        sim.tick(); // ensure we run on init\n      }\n      pulse.modifies('index');\n    } else {\n      if (change) {\n        pulse.modifies('index');\n        sim.nodes(pulse.source);\n      }\n      if (params || pulse.changed(pulse.MOD)) {\n        setup(sim, _, 0, pulse);\n      }\n    }\n\n    // run simulation\n    if (params || change || _.modified(ForceConfig)\n        || (pulse.changed() && _.restart))\n    {\n      sim.alpha(Math.max(sim.alpha(), _.alpha || 1))\n        .alphaDecay(1 - Math.pow(sim.alphaMin(), 1 / iters));\n\n      if (_.static) {\n        for (sim.stop(); --iters >= 0;) sim.tick();\n      } else {\n        if (sim.stopped()) sim.restart();\n        if (!change) return pulse.StopPropagation; // defer to sim ticks\n      }\n    }\n\n    return this.finish(_, pulse);\n  },\n\n  finish(_, pulse) {\n    const dataflow = pulse.dataflow;\n\n    // inspect dependencies, touch link source data\n    for (let args=this._argops, j=0, m=args.length, arg; j<m; ++j) {\n      arg = args[j];\n      if (arg.name !== Forces || arg.op._argval.force !== 'link') {\n        continue;\n      }\n      for (var ops=arg.op._argops, i=0, n=ops.length, op; i<n; ++i) {\n        if (ops[i].name === 'links' && (op = ops[i].op.source)) {\n          dataflow.pulse(op, dataflow.changeset().reflow());\n          break;\n        }\n      }\n    }\n\n    // reflow all nodes\n    return pulse.reflow(_.modified()).modifies(ForceOutput);\n  }\n});\n\nfunction rerun(df, op) {\n  return () => df.touch(op).run();\n}\n\nfunction simulation(nodes, _) {\n  const sim = forceSimulation(nodes),\n        stop = sim.stop,\n        restart = sim.restart;\n  let stopped = false;\n\n  sim.stopped = () => stopped;\n  sim.restart = () => (stopped = false, restart());\n  sim.stop = () => (stopped = true, stop());\n\n  return setup(sim, _, true).on('end', () => stopped = true);\n}\n\nfunction setup(sim, _, init, pulse) {\n  var f = array(_.forces), i, n, p, name;\n\n  for (i=0, n=ForceParams.length; i<n; ++i) {\n    p = ForceParams[i];\n    if (p !== Forces && _.modified(p)) sim[p](_[p]);\n  }\n\n  for (i=0, n=f.length; i<n; ++i) {\n    name = Forces + i;\n    p = init || _.modified(Forces, i) ? getForce(f[i])\n      : pulse && modified(f[i], pulse) ? sim.force(name)\n      : null;\n    if (p) sim.force(name, p);\n  }\n\n  for (n=(sim.numForces || 0); i<n; ++i) {\n    sim.force(Forces + i, null); // remove\n  }\n\n  sim.numForces = f.length;\n  return sim;\n}\n\nfunction modified(f, pulse) {\n  var k, v;\n  for (k in f) {\n    if (isFunction(v = f[k]) && pulse.modified(accessorFields(v)))\n      return 1;\n  }\n  return 0;\n}\n\nfunction getForce(_) {\n  var f, p;\n\n  if (!hasOwnProperty(ForceMap, _.force)) {\n    error('Unrecognized force: ' + _.force);\n  }\n  f = ForceMap[_.force]();\n\n  for (p in _) {\n    if (isFunction(f[p])) setForceParam(f[p], _[p], _);\n  }\n\n  return f;\n}\n\nfunction setForceParam(f, v, _) {\n  f(isFunction(v) ? d => v(d, _) : v);\n}\n"],"names":["ForceMap","center","forceCenter","collide","forceCollide","nbody","forceManyBody","link","forceLink","x","forceX","y","forceY","Forces","ForceParams","ForceConfig","ForceOutput","Force","params","Transform","call","Definition","inherits","transform","_","pulse","sim","value","change","changed","ADD_REM","modified","iters","iterations","simulation","source","on","rerun","dataflow","static","tick","modifies","nodes","MOD","setup","restart","alpha","Math","max","alphaDecay","pow","alphaMin","stop","stopped","StopPropagation","finish","args","_argops","j","m","length","arg","name","op","_argval","force","ops","i","n","changeset","reflow","df","touch","run","forceSimulation","init","f","array","forces","p","getForce","numForces","k","v","isFunction","accessorFields","hasOwnProperty","error","setForceParam","d"],"mappings":"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"}